From 58edd7b033735308afc25c9c0fe36e2a969d5f55 Mon Sep 17 00:00:00 2001
From: Ganesh prasad Sahu <GaneshPrasad_Sahu@comcast.com>
Date: Thu, 1 May 2025 18:37:24 +0000
Subject: [PATCH] comcast manette gamepad digital trigger fix
Source: COMCAST 
Signed-off-by: Ganesh Sahu <ganeshprasad_sahu@comcast.com>

---
 src/manettegamepad/manette_gamepad.cpp | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/manettegamepad/manette_gamepad.cpp b/src/manettegamepad/manette_gamepad.cpp
index c4f1a04..547e8f8 100644
--- a/src/manettegamepad/manette_gamepad.cpp
+++ b/src/manettegamepad/manette_gamepad.cpp
@@ -169,9 +169,11 @@ struct GamepadProvider
     double value = 1.0;
     if (!manette_event_get_button(event, &button))
         return;
-    if (button == BTN_TL2 || button == BTN_TR2) {
+    //Send button pressed with absolute value if an analog trigger
+    if ( (button == BTN_TL2 || button == BTN_TR2) && manette_device_trigger_type(device) ) {
        manette_event_get_button_value(event, &value);
        provider->analogButtonChanged(device, toStandardGamepadButton(button), value);
+       //g_warning("manette-gamepad: buttonPressEvent btn=%u (analog=y) val=%lf\n",button, value);
     }
     else
       provider->buttonPressedOrReleased(device, toStandardGamepadButton(button), true);
@@ -183,9 +185,12 @@ struct GamepadProvider
     double value = 0.0;
     if (!manette_event_get_button(event, &button))
         return;
-    if (button == BTN_TL2 || button == BTN_TR2) {
+
+    //Send button released with absolute value if an analog trigger
+    if ( (button == BTN_TL2 || button == BTN_TR2) && manette_device_trigger_type(device) ) {
        manette_event_get_button_value(event, &value);
        provider->analogButtonChanged(device, toStandardGamepadButton(button), value);
+       //g_warning("manette-gamepad: buttonReleaseEvent btn=%u (analog=y) val=%lf\n",button, value);
     }
     else
       provider->buttonPressedOrReleased(device, toStandardGamepadButton(button), false);
-- 
2.25.1

